# CI workflow for RVSFDT: Qt6 + MinGW 13.1.0 + OpenCV 4.5.5 (bundled) on Windows
name: CMake Build (Qt6 + MinGW + OpenCV)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

env:
  BUILD_TYPE: Release
  QT_VERSION: '6.10.2'

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install Qt6 with MinGW 13.1.0
      uses: jurplel/install-qt-action@v4
      with:
        version: ${{ env.QT_VERSION }}
        host: 'windows'
        target: 'desktop'
        arch: 'win64_mingw'
        tools: 'tools_mingw1310'
        cache: true

    - name: Configure CMake
      run: >
        cmake -B "${{ github.workspace }}/build"
        -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }}
        -DCMAKE_PREFIX_PATH="${{ env.QT_ROOT_DIR }}"
        -DCMAKE_C_COMPILER="${{ env.IQTA_TOOLS }}/mingw1310_64/bin/gcc.exe"
        -DCMAKE_CXX_COMPILER="${{ env.IQTA_TOOLS }}/mingw1310_64/bin/g++.exe"
        -DCMAKE_RC_COMPILER="${{ env.IQTA_TOOLS }}/mingw1310_64/bin/windres.exe"

    - name: Build
      run: cmake --build "${{ github.workspace }}/build" --config ${{ env.BUILD_TYPE }} --parallel

